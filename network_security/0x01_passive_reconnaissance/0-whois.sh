#!/bin/bash
whois "$1" | awk -F: 'BEGIN{split("Registrant|Admin|Tech",S,"|");split("Name|Organization|Street|City|State/Province|Postal Code|Country|Phone|Phone Ext:|Fax|Fax Ext:|Email",F,"|")} {gsub(/^[ \t]+|[ \t]+$/,"",$0);for(s in S)for(f in F)if($0~"^"S[s]" "F[f]||($0~"^"S[s]" Phone Number"&&F[f]=="Phone")){v=$2;gsub(/^[ \t]+|[ \t]+$/,"",v);D[S[s]" "F[f]]=v}} END{for(s=1;s<=3;s++)for(f=1;f<=12;f++){k=S[s]" "F[f];printf "%s, %s",k,(k in D?D[k]:"");if(!(s==3&&f==12))printf "\n"}}' > "$1.csv"
