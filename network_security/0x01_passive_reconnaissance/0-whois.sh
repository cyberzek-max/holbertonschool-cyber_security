#!/bin/bash
whois "$1" 2>/dev/null | awk 'BEGIN{FS=":[ \t]*"} $1~/^Registrant /{s="Registrant"} $1~/^Admin /{s="Admin"} $1~/^Tech /{s="Tech"} s && $1~/^(Registrant|Admin|Tech) (Name|Organization|Street|City|State\/Province|Postal Code|Country|Phone|Phone Ext|Fax|Fax Ext|Email)$/{f=$1; sub(/^(Registrant|Admin|Tech)[ ]+/,"",f); if(f=="Street") line=s" "f", "$2" "; else if(f~/Phone Ext|Fax Ext/) line=s" "f":, "$2; else line=s" "f", "$2; if(c++) printf "\n"; printf "%s",line}' > "$1.csv"
